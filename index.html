<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Runner: Zen Soundscape</title>
    <style>
        body { margin: 0; background: #020205; overflow: hidden; font-family: 'Segoe UI', sans-serif; color: #fff; touch-action: none; }
        #ui { position: absolute; top: 25px; width: 100%; display: flex; justify-content: space-around; z-index: 10; pointer-events: none; }
        .stat { text-align: center; text-transform: uppercase; letter-spacing: 2px; font-size: 10px; opacity: 0.8; }
        .val { font-size: 22px; font-weight: bold; color: #f1c40f; display: block; margin-top: 5px; }
        #start-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 200; cursor: pointer; }
        #game-over { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        canvas { display: block; }
    </style>
</head>
<body>

<div id="start-screen">
    <h1 style="letter-spacing: 10px; color: #f1c40f;">R-RUNNER</h1>
    <p style="opacity: 0.6;">TAP TO START & HEAR THE ZEN</p>
</div>

<div id="ui">
    <div class="stat">Wisdom<span id="score" class="val">0</span></div>
    <div class="stat">Resilience<span id="health" class="val">100%</span></div>
</div>

<div id="game-over">
    <h1 style="color:#ff3e3e; letter-spacing: 5px;">STABILITY LOST</h1>
    <button onclick="location.reload()" style="background:none; border:1px solid #f1c40f; color:#f1c40f; padding:10px 30px; cursor:pointer;">RETRY</button>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let score = 0, health = 100, gameActive = false;
let obstacles = [], wisdoms = [];
let lastObstacleTime = 0;
let frameCount = 0;

// --- REVOLUTIONARY AUDIO SYSTEM ---
let audioCtx;
let masterGain;

function initAudio() {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = audioCtx.createGain();
    masterGain.gain.setValueAtTime(0.15, audioCtx.currentTime);
    masterGain.connect(audioCtx.destination);

    // Constant Zen Background Drone
    const frequencies = [65.41, 98.00, 130.81]; // C2, G2, C3
    frequencies.forEach(f => {
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.value = f;
        g.gain.setValueAtTime(0.02, audioCtx.currentTime);
        osc.connect(g).connect(masterGain);
        osc.start();
    });
}

function playZenNote(f, v=0.1) {
    if (!audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(f, audioCtx.currentTime);
    gain.gain.setValueAtTime(v, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1.5);
    osc.connect(gain).connect(masterGain);
    osc.start();
    osc.stop(audioCtx.currentTime + 1.5);
}

const player = {
    x: 70, y: canvas.height - 135, w: 35, h: 35,
    dy: 0, gravity: 0.6, jumpPower: -12,
    ground: canvas.height - 100,
    jumps: 0,
    update() {
        this.dy += this.gravity;
        this.y += this.dy;
        if (this.y + this.h > this.ground) {
            this.y = this.ground - this.h;
            this.dy = 0;
            this.jumps = 0;
        }
    },
    jump() {
        if (this.jumps < 2) {
            this.dy = this.jumpPower;
            this.jumps++;
            playZenNote(300 + (this.jumps * 150));
        }
    }
};

class Obstacle {
    constructor() {
        this.w = 35; this.h = 35;
        this.x = canvas.width;
        this.y = player.ground - this.h;
    }
    update() {
        this.x -= 5;
        if (player.x < this.x + this.w && player.x + player.w > this.x && player.y + player.h > this.y) {
            health -= 25;
            playZenNote(80, 0.3); // Low thud
            return false;
        }
        return this.x > -50;
    }
    draw() {
        ctx.fillStyle = '#ff3e3e';
        ctx.shadowBlur = 10; ctx.shadowColor = '#ff3e3e';
        ctx.fillRect(this.x, this.y, this.w, this.h);
    }
}

class Wisdom {
    constructor(xOffset) {
        this.x = canvas.width + xOffset;
        this.y = player.ground - 120 + Math.sin(this.x / 120) * 50;
        this.r = 10;
    }
    update() {
        this.x -= 5;
        const dx = (player.x + player.w/2) - this.x;
        const dy = (player.y + player.h/2) - this.y;
        if (Math.sqrt(dx*dx + dy*dy) < 30) {
            score += 100;
            playZenNote(800 + (score/10), 0.05); // Rising sparkle
            return false;
        }
        return this.x > -50;
    }
    draw() {
        ctx.fillStyle = '#f1c40f';
        ctx.shadowBlur = 15; ctx.shadowColor = '#f1c40f';
        ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, 7); ctx.fill();
    }
}

function loop() {
    if (!gameActive) return;
    frameCount++;
    ctx.fillStyle = '#020205';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Ground line
    ctx.strokeStyle = 'rgba(255,255,255,0.1)';
    ctx.beginPath(); ctx.moveTo(0, player.ground); ctx.lineTo(canvas.width, player.ground); ctx.stroke();

    player.update();
    ctx.fillStyle = '#fff';
    ctx.shadowBlur = 20; ctx.shadowColor = '#8e44ad';
    ctx.fillRect(player.x, player.y, player.w, player.h);

    if (frameCount - lastObstacleTime > 150) {
        obstacles.push(new Obstacle());
        lastObstacleTime = frameCount;
    }

    if (frameCount % 70 === 0) {
        wisdoms.push(new Wisdom(0));
    }

    obstacles = obstacles.filter(o => {
        const active = o.update();
        if (active) o.draw();
        return active;
    });

    wisdoms = wisdoms.filter(w => {
        const active = w.update();
        if (active) w.draw();
        return active;
    });

    document.getElementById('score').innerText = score;
    document.getElementById('health').innerText = health + '%';

    if (health <= 0) {
        gameActive = false;
        document.getElementById('game-over').style.display = 'flex';
    }

    requestAnimationFrame(loop);
}

document.getElementById('start-screen').addEventListener('click', () => {
    document.getElementById('start-screen').style.display = 'none';
    initAudio();
    gameActive = true;
    loop();
});

window.addEventListener('touchstart', (e) => {
    if(gameActive) player.jump();
});
window.addEventListener('mousedown', (e) => {
    if(gameActive) player.jump();
});

</script>
</body>
</html>