<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Runner: Gravity Escape</title>
    <style>
        :root { --neon-green: #39ff14; --neon-red: #ff073a; --bg: #0a0a0f; }
        body { margin: 0; overflow: hidden; background: var(--bg); color: white; font-family: 'Orbitron', sans-serif; touch-action: none; }
        
        /* Game Screen */
        #game-view { position: relative; width: 100vw; height: 100vh; border-top: 10px solid #333; border-bottom: 10px solid #333; box-sizing: border-box; }
        
        /* UI */
        #hud { position: fixed; top: 20px; width: 100%; display: flex; justify-content: space-around; z-index: 100; pointer-events: none; }
        .stat { background: rgba(0,255,0,0.1); padding: 10px 20px; border: 1px solid var(--neon-green); border-radius: 5px; font-weight: bold; color: var(--neon-green); text-shadow: 0 0 5px var(--neon-green); }

        /* Character */
        #runner { position: absolute; left: 50px; width: 50px; height: 50px; font-size: 40px; display: flex; align-items: center; justify-content: center; transition: top 0.2s cubic-bezier(0.6, -0.28, 0.735, 0.045); z-index: 50; }
        .on-floor { top: calc(100vh - 110px); transform: scaleY(1); }
        .on-ceiling { top: 60px; transform: scaleY(-1); }

        /* Obstacles */
        .laser { position: absolute; width: 40px; height: 120px; background: var(--neon-red); box-shadow: 0 0 15px var(--neon-red); z-index: 40; }
        .crystal { position: absolute; font-size: 25px; z-index: 40; }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; text-align: center; }
        button { padding: 15px 50px; font-size: 22px; background: var(--neon-green); border: none; color: black; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 20px; box-shadow: 0 0 20px var(--neon-green); }
    </style>
</head>
<body onclick="switchGravity()" ontouchstart="switchGravity()">

<div id="hud">
    <div class="stat">METERS: <span id="dist">0</span></div>
    <div class="stat">RC: <span id="rc">0</span></div>
</div>

<div id="game-view">
    <div id="runner" class="on-floor">ðŸ¤–</div>
</div>

<div id="start-screen" class="overlay">
    <h1 style="font-size: 45px; color: var(--neon-green);">GRAVITY ESCAPE</h1>
    <p>Tap anywhere to flip gravity!<br>Avoid red lasers and collect crystals.</p>
    <button onclick="startGame(event)">INITIALIZE RUN</button>
</div>

<script>
    let distance = 0, rc = 0;
    let gameActive = false;
    let gravityOnFloor = true;
    const runner = document.getElementById('runner');
    const view = document.getElementById('game-view');
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // --- TECHNO BEAT SYSTEM ---
    function playBeat() {
        if(!gameActive) return;
        let time = audioCtx.currentTime;
        
        // Kick Drum
        let kick = audioCtx.createOscillator();
        let kGain = audioCtx.createGain();
        kick.connect(kGain); kGain.connect(audioCtx.destination);
        kick.frequency.setValueAtTime(150, time);
        kick.frequency.exponentialRampToValueAtTime(0.01, time + 0.1);
        kGain.gain.setValueAtTime(0.3, time);
        kGain.gain.exponentialRampToValueAtTime(0.01, time + 0.1);
        kick.start(time); kick.stop(time + 0.1);

        // Synth Note
        let synth = audioCtx.createOscillator();
        let sGain = audioCtx.createGain();
        synth.type = 'sawtooth';
        synth.frequency.setValueAtTime(gravityOnFloor ? 110 : 220, time);
        synth.connect(sGain); sGain.connect(audioCtx.destination);
        sGain.gain.setValueAtTime(0.02, time);
        sGain.gain.exponentialRampToValueAtTime(0.0001, time + 0.4);
        synth.start(time); synth.stop(time + 0.5);

        setTimeout(playBeat, 500);
    }

    function switchGravity(e) {
        if(!gameActive) return;
        if(e) e.preventDefault();
        gravityOnFloor = !gravityOnFloor;
        runner.className = gravityOnFloor ? 'on-floor' : 'on-ceiling';
        
        // Switch sound
        let osc = audioCtx.createOscillator();
        let gain = audioCtx.createGain();
        osc.frequency.value = gravityOnFloor ? 300 : 600;
        osc.connect(gain); gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.start(); osc.stop(audioCtx.currentTime + 0.1);
    }

    function startGame(e) {
        e.stopPropagation();
        document.getElementById('start-screen').style.display = 'none';
        gameActive = true;
        if(audioCtx.state === 'suspended') audioCtx.resume();
        playBeat();
        spawnObstacle();
        gameLoop();
    }

    function gameLoop() {
        if(!gameActive) return;
        distance++;
        document.getElementById('dist').innerText = Math.floor(distance/10);
        requestAnimationFrame(gameLoop);
    }

    function spawnObstacle() {
        if(!gameActive) return;
        const isCrystal = Math.random() > 0.6;
        const obj = document.createElement('div');
        
        if(isCrystal) {
            obj.className = 'crystal';
            obj.innerHTML = 'ðŸ’Ž';
            obj.style.top = Math.random() > 0.5 ? 'calc(100vh - 100px)' : '70px';
        } else {
            obj.className = 'laser';
            const onTop = Math.random() > 0.5;
            obj.style.top = onTop ? '0' : 'calc(100vh - 130px)';
            obj.style.height = '130px';
        }

        obj.style.right = '-50px';
        view.appendChild(obj);

        let pos = -50;
        const move = setInterval(() => {
            if(!gameActive) { clearInterval(move); obj.remove(); return; }
            pos += (7 + distance/1000);
            obj.style.right = pos + 'px';

            // Collision logic
            let rRect = runner.getBoundingClientRect();
            let oRect = obj.getBoundingClientRect();

            if(rRect.left < oRect.right && rRect.right > oRect.left && rRect.top < oRect.bottom && rRect.bottom > oRect.top) {
                if(isCrystal) {
                    rc += 5;
                    document.getElementById('rc').innerText = rc;
                    obj.remove();
                    clearInterval(move);
                } else {
                    gameOver();
                }
            }

            if(pos > window.innerWidth) {
                clearInterval(move);
                obj.remove();
            }
        }, 20);

        setTimeout(spawnObstacle, Math.max(500, 1500 - distance/20));
    }

    function gameOver() {
        gameActive = false;
        alert("TERMINATED! Gravity system failed.\nDistance: " + Math.floor(distance/10) + "m\nRC: " + rc);
        location.reload();
    }
</script>
</body>
</html>