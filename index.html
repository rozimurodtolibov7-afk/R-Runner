<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Dash: Vertical Tower</title>
    <style>
        :root { --neon: #bc13fe; --danger: #ff0055; --bg: #0a0a0f; }
        body { margin: 0; overflow: hidden; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; touch-action: none; }
        canvas { display: block; }

        /* HUD */
        #hud { position: fixed; top: 15px; width: 100%; display: flex; justify-content: space-around; z-index: 100; pointer-events: none; }
        .stat { background: rgba(0,0,0,0.8); padding: 8px 15px; border: 1px solid var(--neon); border-radius: 5px; font-weight: bold; }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; text-align: center; }
        button { padding: 15px 50px; font-size: 20px; background: var(--neon); border: none; color: white; font-weight: bold; border-radius: 5px; cursor: pointer; margin-top: 25px; box-shadow: 0 0 15px var(--neon); }
    </style>
</head>
<body>

<div id="hud">
    <div class="stat">HEIGHT: <span id="height-val">0</span>m</div>
    <div class="stat">RC: <span id="rc-val">0</span></div>
</div>

<div id="start-screen" class="overlay">
    <h1 style="font-size: 40px; color: var(--neon);">CYBER DASH</h1>
    <p>Tap to jump! Climb as high as you can.<br>Don't fall and avoid the red laser floor!</p>
    <button onclick="startMission()">START CLIMB</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let gameActive = false;
    let score = 0, rc = 0, cameraY = 0;
    
    const player = { x: 0, y: 0, w: 30, h: 30, dy: 0, dx: 0, jump: -12, speed: 5 };
    let platforms = [];
    let crystals = [];

    // --- BUILT-IN TECHNO MUSIC ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(freq, type, vol, dur) {
        if(!gameActive) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type; osc.frequency.value = freq;
        osc.connect(gain); gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
        osc.start(); osc.stop(audioCtx.currentTime + dur);
    }

    function init() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        player.x = canvas.width / 2 - 15;
        player.y = canvas.height - 100;
        platforms = [];
        // Base platform
        platforms.push({ x: 0, y: canvas.height - 20, w: canvas.width, h: 20 });
        for(let i=1; i<10; i++) spawnPlatform(canvas.height - i * 120);
    }

    function spawnPlatform(y) {
        const w = 80 + Math.random() * 50;
        const x = Math.random() * (canvas.width - w);
        platforms.push({ x, y, w, h: 15 });
        if(Math.random() > 0.7) crystals.push({ x: x + w/2 - 10, y: y - 30, w: 20, h: 20 });
    }

    window.onpointerdown = () => {
        if(!gameActive) return;
        if(player.dy === 0) { // Only jump if on platform
            player.dy = player.jump;
            playSound(400, 'sine', 0.1, 0.2);
        }
    };

    function startMission() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        document.getElementById('start-screen').style.display = 'none';
        init();
        gameActive = true;
        
        // Background Beat
        setInterval(() => {
            if(gameActive) playSound(60, 'square', 0.05, 0.1);
        }, 400);

        update();
    }

    function update() {
        if(!gameActive) return;

        ctx.fillStyle = '#0a0a0f';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Physics
        player.dy += 0.5; // Gravity
        player.y += player.dy;

        // Camera follow
        if(player.y < canvas.height / 2) {
            let diff = canvas.height / 2 - player.y;
            player.y = canvas.height / 2;
            cameraY += diff;
            score += Math.floor(diff/10);
            
            platforms.forEach(p => p.y += diff);
            crystals.forEach(c => c.y += diff);
        }

        // Platforms drawing and collision
        ctx.fillStyle = varColor('--neon');
        platforms.forEach((p, i) => {
            ctx.fillRect(p.x, p.y, p.w, p.h);
            if(player.dy > 0 && 
               player.x + player.w > p.x && player.x < p.x + p.w &&
               player.y + player.h > p.y && player.y + player.h < p.y + p.h + player.dy) {
                player.y = p.y - player.h;
                player.dy = 0;
            }
            if(p.y > canvas.height) {
                platforms.splice(i, 1);
                spawnPlatform(platforms[platforms.length-1].y - 120);
            }
        });

        // Crystals
        crystals.forEach((c, i) => {
            ctx.fillText('ðŸ’Ž', c.x, c.y + 20);
            if(Math.hypot(player.x - c.x, player.y - c.y) < 30) {
                rc += 10;
                playSound(800, 'sine', 0.1, 0.1);
                crystals.splice(i, 1);
            }
            if(c.y > canvas.height) crystals.splice(i, 1);
        });

        // Player move (auto move towards tap or center)
        player.x += player.dx;
        
        // Draw Player
        ctx.font = '30px Arial';
        ctx.fillText('ðŸ¤–', player.x, player.y + 25);

        // Laser Floor (Dead Zone)
        ctx.fillStyle = 'rgba(255, 0, 85, 0.3)';
        ctx.fillRect(0, canvas.height - 20, canvas.width, 20);

        document.getElementById('height-val').innerText = score;
        document.getElementById('rc-val').innerText = rc;

        if(player.y > canvas.height) gameOver();

        requestAnimationFrame(update);
    }

    function varColor(name) { return getComputedStyle(document.documentElement).getPropertyValue(name); }

    function gameOver() {
        gameActive = false;
        playSound(100, 'sawtooth', 0.2, 0.5);
        alert(`FALLEN!\nHeight: ${score}m\nRC: ${rc}`);
        location.reload();
    }

    // Accelerometer or Touch Side
    window.onpointermove = (e) => {
        let center = canvas.width / 2;
        player.dx = (e.clientX - center) / 10;
    };
</script>
</body>
</html>