<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Pulse: Music Runner</title>
    <style>
        :root { --neon-pink: #ff00ff; --neon-cyan: #00ffff; --bg: #050505; }
        body { margin: 0; overflow: hidden; background: var(--bg); color: white; font-family: 'Courier New', monospace; touch-action: none; }
        canvas { display: block; }

        #hud { position: fixed; top: 20px; width: 100%; display: flex; justify-content: space-around; z-index: 100; pointer-events: none; }
        .stat { background: rgba(0,0,0,0.8); padding: 10px 20px; border: 2px solid var(--neon-cyan); border-radius: 5px; box-shadow: 0 0 15px var(--neon-cyan); }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; text-align: center; }
        h1 { font-size: 50px; text-shadow: 0 0 20px var(--neon-pink); margin-bottom: 10px; }
        button { padding: 15px 60px; font-size: 22px; background: transparent; border: 2px solid var(--neon-pink); color: var(--neon-pink); cursor: pointer; transition: 0.3s; box-shadow: 0 0 10px var(--neon-pink); }
    </style>
</head>
<body onclick="handleAction()" ontouchstart="handleAction()">

<div id="hud">
    <div class="stat">PULSE: <span id="dist">0</span></div>
    <div class="stat">RC: <span id="rc">0</span></div>
</div>

<div id="start-screen" class="overlay">
    <h1>THE PULSE</h1>
    <p>Tap to JUMP. Avoid obstacles.<br>Speed: Relaxed | Rhythm: Synced</p>
    <button onclick="initPulse(event)">START MISSION</button>
</div>

<canvas id="pulseCanvas"></canvas>

<script>
    const canvas = document.getElementById('pulseCanvas');
    const ctx = canvas.getContext('2d');
    let gameActive = false, score = 0, rc = 0;
    
    // player.dy va gravitatsiya sekinlashtirildi
    const player = { x: 80, y: 0, w: 40, h: 40, dy: 0, jumping: false, ground: 0 };
    let obstacles = [];

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playBeat(freq, type, dur, vol, timeOffset = 0) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime + timeOffset);
        osc.connect(gain); gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime + timeOffset);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur + timeOffset);
        osc.start(audioCtx.currentTime + timeOffset);
        osc.stop(audioCtx.currentTime + dur + timeOffset);
    }

    function musicLoop() {
        if(!gameActive) return;
        playBeat(60, 'sine', 0.2, 0.4); // Kick
        playBeat(800, 'square', 0.05, 0.03, 0.5); // Snare
        
        if (Math.random() > 0.3) spawnObstacle(); // Randomly spawn on beat
        
        setTimeout(musicLoop, 1200); // Sekinroq temp (BPM pasaytirildi)
    }

    function initPulse(e) {
        if(e) e.stopPropagation();
        if (audioCtx.state === 'suspended') audioCtx.resume();
        document.getElementById('start-screen').style.display = 'none';
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        player.ground = canvas.height - 150;
        player.y = player.ground;

        gameActive = true;
        musicLoop();
        update();
    }

    function handleAction(e) {
        if(e) e.preventDefault();
        if(!gameActive) return;
        if(!player.jumping) {
            player.dy = -15; // Sakrash kuchi sekinlashtirildi
            player.jumping = true;
            playBeat(400, 'triangle', 0.2, 0.1);
        }
    }

    function spawnObstacle() {
        obstacles.push({ x: canvas.width, y: player.ground, w: 45, h: 65 });
    }

    function update() {
        if(!gameActive) return;

        ctx.fillStyle = `rgba(5, 5, 5, 0.4)`;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Floor
        ctx.strokeStyle = '#00ffff';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(0, player.ground + 40);
        ctx.lineTo(canvas.width, player.ground + 40);
        ctx.stroke();

        // Player Gravity (Sekinroq tushish)
        player.dy += 0.6; 
        player.y += player.dy;
        if(player.y > player.ground) {
            player.y = player.ground;
            player.dy = 0;
            player.jumping = false;
        }

        // Draw Player
        ctx.fillStyle = '#ff00ff';
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#ff00ff';
        ctx.fillRect(player.x, player.y, player.w, player.h);
        ctx.shadowBlur = 0;

        // Obstacles (Sekinroq harakat)
        obstacles.forEach((obs, i) => {
            obs.x -= 4.5; // Tezlik 6 dan 4.5 ga tushirildi
            ctx.fillStyle = '#111';
            ctx.strokeStyle = '#00ffff';
            ctx.strokeRect(obs.x, obs.y, obs.w, obs.h);
            ctx.fillRect(obs.x, obs.y, obs.w, obs.h);

            // Collision
            if(player.x < obs.x + obs.w && player.x + player.w > obs.x && 
               player.y < obs.y + obs.h && player.y + player.h > obs.y) {
                gameOver();
            }

            if(obs.x < -100) obstacles.splice(i, 1);
        });

        score++;
        document.getElementById('dist').innerText = Math.floor(score/10);
        document.getElementById('rc').innerText = Math.floor(score/50);
        requestAnimationFrame(update);
    }

    function gameOver() {
        gameActive = false;
        playBeat(50, 'sawtooth', 0.5, 0.2);
        setTimeout(() => {
            alert("GAME OVER\nPulse Level: " + Math.floor(score/10));
            location.reload();
        }, 100);
    }
</script>
</body>
</html>